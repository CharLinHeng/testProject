<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <title>程序爷码题网</title>
</head>
<link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
<script src="source/js/jquery_need.js"></script>
<!---->
<script src="edit/dist/summernote.js"></script>
<script src="edit/dist/lang/summernote-zh-CN.js"></script>
<link href="edit/dist/summernote.css" rel="stylesheet">
<style type="text/css">
    .panel-heading:hover{
        background: rgba(0,0,0,0.09);
        cursor: pointer;
    }
    .panel-footer:hover{
        background: rgba(0,0,0,0.09);
        cursor: pointer;
    }
    .panel-body:hover{
        background: rgba(0,0,0,0.09);
        cursor: pointer;
    }
    .progress{
        height: 4px;
        margin: 0 auto;
    }
</style>
<!--<style rel="" src="">-->
<!---->
<!--</style>-->
<link rel="stylesheet" href="source/bootstrap-4.4.1-dist/css/bookstrap.css">
<html lang="en">
    <body>

        <div style="height: 50px;"></div>
        <div class="progress progress-striped active" id="all">
            <div id="pro" class="progress-bar progress-bar-success" role="progressbar"
                 aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"
                 style="width: 0%;">
                <span class="sr-only">40% 完成</span>
            </div>
        </div>
        <div style="height: 30px;"></div>
        <div class="container">
            <div class="row clearfix">
                <div class="col-md-12 column">
                    <div class="alert alert-warning">注册只需要自定义用户名和密码哦!由于网络原因，可以多进行刷新试试。</div>
                    <ul class="breadcrumb">
                        <li>
                            <a href="#">程序爷刷题网</a>
                        </li>
                        <li>
                            <a href="#">...</a>
                        </li>
                    </ul>
                    <ul id="load_data_topic" class="nav nav-tabs">
                    </ul>
                    <div id="myTabContent" class="tab-content">
                    </div>

                    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
                        <div class="navbar-header">
                            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"> <span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button> <a class="navbar-brand" href="#">Brand</a>
                        </div>
                        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                            <ul class="nav navbar-nav">
                                <li>
                                    <a href="#">更多</a>
                                </li>
                            </ul>
                            <form class="navbar-form navbar-left" role="search">
                                <div class="form-group">
                                    <input type="text" class="form-control" placeholder="搜索题目或者题组" />
                                </div> <button type="submit" class="btn btn-default">查找</button>
                            </form>
                            <ul class="nav navbar-nav navbar-right" style="position: relative;left: -80px;">
                                <li>
                                    <a href="login.html">登入</a>
                                </li>
                                <li class="dropdown">
                                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">注册<strong class="caret"></strong></a>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <a href="register.html" style="text-align: center;">普通注册</a>
                                        </li>
                                        <li class="divider">
                                        </li>
                                        <li>
                                            <a href="register.html" style="text-align: center;">微信注册</a>
                                        </li>
                                        <li>
                                            <a href="register.html" style="text-align: center;">邮箱注册</a>
                                        </li>
                                        <li class="divider">
                                        </li>

                                        <li>
                                            <a href="register.html" style="text-align: center;">短信注册</a>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </div>

                        <!--prograss-->
                    </nav>
                    <ul class="pagination" style="justify-content: center;display: flex;">
                        <li>
                            <a href="#">上一页</a>
                        </li>
                        <li>
                            <a href="#">1</a>
                        </li>

                        <li>
                            <a href="#">下一页</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <button data-toggle="modal" hidden id="tip" data-target="#myModal"></button>
        <!-- 模态框（Modal） -->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="myModalLabel"></h4>
                    </div>
                    <div class="modal-body" id="text"></div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>

                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal -->
        </div>
    </body>
</html>

<script>
    $(document).ready(function () {


    })
    var all_count = 10;
    function queryGroup() {

        if (window.XMLHttpRequest) {
            var request = new XMLHttpRequest();

            request.onreadystatechange = function () {
                if (request.readyState == 4 && request.status == 200) {

                    for(var i = 1;i<request.responseText.split("}").length-1;i++){
                        if(i == 1){
                            str = '<li class="active"><a id="first" href="#home-'+i+'" data-toggle="tab">'+request.responseText.split("}")[i].split("|")[1]+'</a></li>';
                        }
                        else{
                            str = '<li id="second'+i+'"><a id="second'+i+'" href="#home-'+i+'" data-toggle="tab">'+request.responseText.split("}")[i].split("|")[1]+'</a></li>';
                        }
                        $("#load_data_topic").append(str);

                        // if(i == 1){
                            var data_ = queryThisGroup(request.responseText.split("}")[i].split("|")[1],i);

                    }
                    $("#pro").css("width","100%");
                    $("#all").fadeOut(2000);
                }
                ;
            }
            request.open("GET", "GetData.jsp?getOrigient=GROUPTYPE", true);
            request.send();
        }
    }
    function queryThisGroup(sign,index){
        if (window.XMLHttpRequest) {
            var request = new XMLHttpRequest();
            request.onreadystatechange = function () {
                if (request.readyState == 4 && request.status == 200) {

                    if(index == 1){
                       var str_add = "active";
                    }
                    else{
                       var str_add = "";
                    }
                    str='<div class="tab-pane fade in '+str_add+'" id="home-'+index+'">\n' +
                        '                                <div class="panel panel-default" id="curr_'+index+'">\n' +
                        '                                </div>\n' +
                        '                            </div>';
                    $("#myTabContent").append(str);
                    for(var j = 1;j<request.responseText.split("}").length-1;j++){
                        var data = request.responseText.split("}")[j].split("|");
                        // alert(data);
                        //添加md5verct
                        $("#myTabContent").append('<input type="text" hidden id="signmd5'+all_count+'" value="'+data[0]+'">');
                        //标题
                        // alert(data[1]);
                        //是否需要邀请码
                        var invest = "";
                        var invest_judge = 0;
                        if(data[3].length<2){
                            invest = "不需要邀请码";
                            invest_judge = 1;
                        }
                        else{
                            invest = "需要输入邀请码";
                            invest_judge = 2;
                        }
                        var inverst_need = '<span class="label label-danger">'+invest+'</span>';
                        //生成日期
                        var creatdate = data[5];
                        //生成用户
                        var user  = data[6];
                        //最大参与人数
                        var maxpeoplecan = data[7];
                        var max_label = '<span class="label label-danger">最多用户参与上限:'+maxpeoplecan+'</span>';
                        //当前参与人数
                        var curr_pratician = data[8];
                        //总分
                        var allscore = data[9];
                        var all_score_ = '<span class="label label-default">总分:'+allscore+'</span>';
                        //is can go?
                        if(data[10]!="1"){
                            continue;
                        }
                         //satrttime

                        var st = data[11];
                        //endtime
                        var et = data[12];
                        //labguagelimit
                        if(data[13]=="*"){
                            var ll = "无语言限制";
                        }
                        else{
                            var ll = "可用语言:"+data[13];
                        }
                        var can_language = '<span class="label label-success">'+ll+'</span>';
                        //时间计算，
                        var tip = "正在进行";
                        var currDate = new Date();
                        var timecorre = 0;
                        if(st.length<3||et.length<3){
                            tip = "无时间限制";
                            var timestr = '<button type="button" class="btn btn-default btn-sm">\n' +
                                '<span class="glyphicon glyphicon-time"></span>\n' +
                                '\n' +tip+
                                '</button>';
                            timecorre = 1;
                        }
                        else{
                            tip = calc(currDate,new Date(st.replace(/-/g, "/")),new Date(et.replace(/-/g, "/")),st,et);
                            if(tip.indexOf("已经")!=-1){
                                var timestr = '<button type="button" class="btn btn-default btn-sm">' +
                                '<span class="glyphicon glyphicon-eye-open"></span>'+tip+'</button>';
                                timecorre = 3;
                            }
                            else if(tip.indexOf("结束")!=-1){
                                timecorre = 400;
                                var timestr = '<button type="button" class="btn btn-default btn-sm">\n' +
                                    '<span class="glyphicon glyphicon-ban-circle"></span>\n'+tip+
                                    '</button>';
                            }
                            else{
                                timecorre = 2;
                                var timestr = '<button type="button" class="btn btn-default btn-sm">\n' +
                                    '<span class="glyphicon glyphicon-ban-circle"></span>\n'+tip+
                                    '</button>';
                            }

                        }
                        //查询数据？
                        var detail ='onclick="judge('+timecorre+','+invest_judge+','+all_count+')"';
                        str = '                                    <div class="panel-body" '+detail+'>\n' +
                            '                                       '+data[1]+'\n' +
                             timestr+' '+max_label+ ' '+can_language+' '+inverst_need+' '+all_score_
                            '                                    </div>\n';
                        $("#curr_"+index).append(str);

                        all_count++;
                    }
                    // if(request.responseText.split("}").length-1 == 1){
                    //     alert("空");
                    // }
                }


            }
            request.open("GET", "GetData.jsp?getOrigient=GROUPTYPE_ANDTITLE_ALL&sign="+encodeURI(encodeURI(sign)), true);
            request.send();
        }

    }
    queryGroup();
    // load_data_topic
    function judge(time,invest,m) {
        if(time == 2){
            mtkshow("错误","该题组还没有开始！");
            return ;
        }
        else if(time ==400 ){
            mtkshow("错误","该题组已经结束了！");
            return ;
        }
        if(invest == 2){
            mtkshow("进入",'请输入邀请码'+'  <div class="input-group">\n' +
                '                    <input type="text" class="form-control">\n' +
                '                    <span class="input-group-btn">\n' +
                '                        <button class="btn btn-default" type="button">前往</button>\n' +
                '                    </span>\n' +
                '                </div><!-- /input-group -->');
            return ;
        }
        setCookie("title",$("#signmd5"+m).val());
        window.location.href="code_select.html";

    }
    function setCookie(name,value)
    {
        var Days = 30;
        var exp = new Date();
        exp.setTime(exp.getTime()+60*60*1000);
        document.cookie = name + "="+ escape (value) + ";expires=" + exp.toGMTString();
    }
    function delCookie(name)
    {
        var exp = new Date();
        exp.setTime(exp.getTime() - 1);
        var cval=getCookie(name);
        if(cval!=null)
            document.cookie= name + "="+cval+";expires="+exp.toGMTString();
    }
    function mtkshow(title,text){
        $("#myModalLabel").html(title);
        $("#text").html(text);
        $("#tip").click();
    }
    function calc(curr,st,et,ost,oet){
        var string = "";
        if(et.getTime()<curr.getTime()) {
            return string ="已经结束了!";
        }

        if(et.getTime()-st.getTime()<0){
            return string ="日期错误!";
        }
       if(curr.getTime()>=st.getTime()){
           return string = "已经开始,结束时间为:"+oet;
       }else{
          return string = "还未开始,开始时间为:"+ost;
       }


    }
</script>